# ===================================================================
# TNE Catalyst - Development Environment Configuration
# ===================================================================
# Use this for LOCAL DEVELOPMENT on your laptop/workstation
#
# Usage:
#   docker compose --env-file .env.dev up -d
#
# Last Updated: 2025-01-13
# ===================================================================

# -------------------------------------------------------------------
# SERVER CONFIGURATION
# -------------------------------------------------------------------

# Host URL - used for callbacks and external references
PBS_HOST_URL=http://localhost:8000

# Port the server listens on
PBS_PORT=8000

# -------------------------------------------------------------------
# DATABASE CONFIGURATION (PostgreSQL)
# -------------------------------------------------------------------

# Database connection settings
DB_HOST=localhost
DB_PORT=5432
DB_NAME=catalyst_dev
DB_USER=catalyst_dev
DB_PASSWORD=dev_password_change_me

# SSL mode for database connection
# Options: disable, require, verify-ca, verify-full
# Use "disable" for local development
DB_SSL_MODE=disable

# Connection pool settings
DB_MAX_OPEN_CONNS=25
DB_MAX_IDLE_CONNS=5
DB_CONN_MAX_LIFETIME=300s

# -------------------------------------------------------------------
# REDIS CONFIGURATION
# -------------------------------------------------------------------

# Redis connection settings
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=0

# Redis pool settings (development)
REDIS_POOL_SIZE=10
REDIS_IDLE_TIMEOUT=300s
REDIS_POOL_TIMEOUT=4s

# Redis key TTL defaults (in seconds)
REDIS_AUCTION_TTL=300
REDIS_CACHE_TTL=3600

# -------------------------------------------------------------------
# IDR (INTELLIGENT DEMAND ROUTER) - OPTIONAL
# -------------------------------------------------------------------

# Disable IDR for initial development
# The system works fine without IDR - it's an optional ML enhancement
IDR_ENABLED=false

# IDR service URL (only used if IDR_ENABLED=true)
IDR_URL=http://localhost:8080

# IDR timeout and retry settings
IDR_TIMEOUT=500ms
IDR_RETRY_ATTEMPTS=2
IDR_FALLBACK_ENABLED=true

# -------------------------------------------------------------------
# IVT (INVALID TRAFFIC) DETECTION
# -------------------------------------------------------------------

# Enable IVT detection but don't block (monitoring only)
IVT_BLOCKING_ENABLED=false

# Allow all countries in development
IVT_ALLOWED_COUNTRIES=*

# IVT checks (all enabled for testing)
IVT_CHECK_USER_AGENT=true
IVT_CHECK_IP_REPUTATION=true
IVT_CHECK_GEO_MISMATCH=true
IVT_CHECK_SUSPICIOUS_PATTERNS=true

# Threshold for suspicious activity (0.0 - 1.0)
# Lower = more strict, Higher = more permissive
IVT_SUSPICIOUS_THRESHOLD=0.7

# -------------------------------------------------------------------
# CORS (CROSS-ORIGIN RESOURCE SHARING)
# -------------------------------------------------------------------

# Allow all origins in development (permissive)
CORS_ALLOWED_ORIGINS=*

# CORS settings
CORS_ALLOW_CREDENTIALS=true
CORS_MAX_AGE=3600

# -------------------------------------------------------------------
# AUCTION CONFIGURATION
# -------------------------------------------------------------------

# Auction timeout (max time to wait for bids)
AUCTION_TIMEOUT=2s

# Maximum bidders to call per auction
AUCTION_MAX_BIDDERS=10

# Enable parallel bidding
AUCTION_PARALLEL_BIDDING=true

# -------------------------------------------------------------------
# RATE LIMITING
# -------------------------------------------------------------------

# Rate limit settings (requests per second)
RATE_LIMIT_GENERAL=1000
RATE_LIMIT_AUCTION=500

# Burst allowance
RATE_LIMIT_BURST=100

# -------------------------------------------------------------------
# LOGGING
# -------------------------------------------------------------------

# Log level: debug, info, warn, error
# Use "debug" for development to see everything
LOG_LEVEL=debug

# Log format: json, text
# Use "text" for easier reading during development
LOG_FORMAT=text

# Enable request logging
LOG_REQUESTS=true

# Enable performance metrics logging
LOG_METRICS=true

# -------------------------------------------------------------------
# SECURITY & HEADERS
# -------------------------------------------------------------------

# Disable security features for local development
SECURITY_HSTS_ENABLED=false
SECURITY_CSRF_ENABLED=false

# Trust proxy headers (for localhost reverse proxy testing)
TRUST_PROXY=true

# -------------------------------------------------------------------
# FEATURE FLAGS
# -------------------------------------------------------------------

# Enable experimental features for testing
FEATURE_EXPERIMENTAL_BIDDERS=true
FEATURE_ADVANCED_TARGETING=true
FEATURE_DEBUG_ENDPOINTS=true

# -------------------------------------------------------------------
# DEVELOPMENT HELPERS
# -------------------------------------------------------------------

# Enable pprof profiling endpoints
PPROF_ENABLED=true

# Enable debug endpoints
DEBUG_ENDPOINTS=true

# Hot reload (if supported)
HOT_RELOAD=true

# -------------------------------------------------------------------
# NOTES
# -------------------------------------------------------------------
#
# Development Environment Characteristics:
# ✓ Permissive CORS (allows all origins)
# ✓ Debug logging enabled
# ✓ IVT monitoring only (no blocking)
# ✓ IDR disabled (simpler setup)
# ✓ Low rate limits (local testing)
# ✓ Security features relaxed
#
# DO NOT use this configuration in production!
#
# -------------------------------------------------------------------
